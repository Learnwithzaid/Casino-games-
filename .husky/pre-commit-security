#!/bin/sh
# Pre-commit hook for security validation

echo "ğŸ”’ Running security pre-commit checks..."

# Check for environment file leakage
echo "ğŸ” Checking for environment file leakage..."
if git diff --cached --name-only | grep -E '\.env(\.local|\.development|\.test)?$' | grep -v '\.env\.example$'; then
    echo "âŒ Error: Environment files should not be committed to git!"
    echo "   Please remove .env files from git tracking:"
    echo "   git rm --cached .env .env.local .env.development .env.test"
    exit 1
fi

# Run security linting
echo "ğŸ›¡ï¸  Running security linting..."
npm run lint:security
if [ $? -ne 0 ]; then
    echo "âŒ Security linting failed!"
    exit 1
fi

# Run type checking
echo "ğŸ“ Running type checking..."
npm run typecheck
if [ $? -ne 0 ]; then
    echo "âŒ Type checking failed!"
    exit 1
fi

# Security dependency audit
echo "ğŸ” Running security dependency audit..."
npm run security:audit
if [ $? -ne 0 ]; then
    echo "âŒ Security dependency audit failed!"
    echo "   Please fix security vulnerabilities before committing."
    exit 1
fi

echo "âœ… All security pre-commit checks passed!"
exit 0